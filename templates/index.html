<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>穴位查询</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            padding: 20px;
        }
        select, button {
            margin: 5px;
            padding: 10px;
            font-size: 16px;
        }
        #result {
            margin-top: 20px;
            font-size: 18px;
            white-space: pre-line;
            text-align: left;
        }
    </style>
</head>
<body>

    <h2>穴位查询</h2>

    <!-- 经络下拉菜单 -->
    <label for="meridian">选择经络：</label>
    <select id="meridian">
        <option value="肺经">肺经</option>
        <option value="心经">心经</option>
        <option value="心包经">心包经</option>
        <option value="大肠经">大肠经</option>
        <option value="小肠经">小肠经</option>
        <option value="三焦经">三焦经</option>
        <option value="脾经">脾经</option>
        <option value="肾经">肾经</option>
        <option value="肝经">肝经</option>
        <option value="胃经">胃经</option>
        <option value="膀胱经">膀胱经</option>
        <option value="胆经">胆经</option>
    </select>

    <!-- 穴位类别下拉菜单 -->
    <label for="category">选择穴位类别：</label>
    <select id="category">
        <option value="原穴">原穴</option>
        <option value="络穴">络穴</option>
        <option value="背俞穴">背俞穴</option>
        <option value="募穴">募穴</option>
        <option value="郄穴">郄穴</option>
        <option value="八会穴">八会穴</option>
        <option value="八脉交会穴">八脉交会穴</option>
        <option value="下合穴">下合穴</option>
        <option value="四总穴">四总穴</option>
    </select>

    <!-- 查询按钮 -->
    <button onclick="queryAcupoints()">查询穴位</button>

    <!-- 结果显示 -->
    <div id="result"></div>
<script>
    // ✅ 自动检测是本地还是线上环境，动态设置 API 地址
    const API_BASE_URL = "https://wushu-db.onrender.com/";  // 线上 Flask 服务器（替换为你的真实 URL）

    function fetchAcupoints() {
        let meridian = document.getElementById("meridian").value;
        let condition = document.getElementById("condition").value;
        let method = document.getElementById("method").value;

        if (!meridian || !condition || !method) {
            alert("请完整选择所有选项！");
            return;
        }

        // ✅ 发送请求到 Flask API
        fetch(`${API_BASE_URL}/get_acupoints?meridian=${meridian}&condition=${condition}&method=${method}`)
            .then(response => response.json())
            .then(data => {
                let resultsDiv = document.getElementById("results");
                resultsDiv.innerHTML = "";

                if (data.status === "success" && data.results.length > 0) {
                    data.results.forEach(item => {
                        let entry = document.createElement("p");
                        entry.innerHTML = `<strong>${item.technique}</strong>: ${item.acupoints}`;
                        resultsDiv.appendChild(entry);
                    });
                } else {
                    resultsDiv.innerHTML = "<p>未找到匹配的穴位信息。</p>";
                }
            })
            .catch(error => {
                console.error("Error fetching data:", error);
                document.getElementById("results").innerHTML = "<p>查询失败，请检查服务器是否正常运行。</p>";
            });
    }
</script>

</body>
</html>
